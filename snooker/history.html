<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histórico de Partidas - Ranking Sinuca</title>
    <script>
        // Prevent flash - apply theme immediately before any CSS loads
        (function() {
            try {
                const currentMode = localStorage.getItem('darkMode');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const shouldBeDark = currentMode === 'enabled' || (!currentMode && prefersDark);
                
                if (shouldBeDark) {
                    document.documentElement.className = 'dark-mode';
                    const style = document.createElement('style');
                    style.id = 'prevent-flash';
                    style.textContent = `
                        html, html.dark-mode, body, body.dark-mode { 
                            background-color: #121212 !important; 
                            color: #e0e0e0 !important; 
                        }
                        html.dark-mode h1, body.dark-mode h1 { color: #e0e0e0 !important; }
                    `;
                    document.head.insertBefore(style, document.head.firstChild);
                } else {
                    const style = document.createElement('style');
                    style.id = 'prevent-flash';
                    style.textContent = `
                        html, body { 
                            background-color: #f8f9fa !important; 
                            color: #212529 !important; 
                        }
                        h1 { color: #212529 !important; }
                    `;
                    document.head.insertBefore(style, document.head.firstChild);
                }
            } catch(e) {}
        })();
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://github.com/lucaohost/lucaohost.github.io/blob/master/snooker-scoreboard/assets/favicon3.png?raw=true" />
</head>
<body>
    <div class="container">        
        <div class="text-end my-2">
            <button id="darkModeToggle" class="dark-mode-toggle" aria-label="Toggle dark mode">
                <span class="toggle-track">
                    <span class="toggle-thumb">
                        <i class="fas fa-sun"></i>
                        <i class="fas fa-moon"></i>
                    </span>
                </span>
            </button>
        </div>
        <h1 class="text-center my-4">Histórico de Partidas - Temporada 2026</h1>
        
        <div class="text-center mb-3">
            <a href="index.html" class="btn btn-style">
                <i class="fas fa-arrow-left"></i> Voltar ao Ranking
            </a>
        </div>
        
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Data</th>
                        <th>Vencedores</th>
                        <th>Perdedores</th>
                    </tr>
                </thead>
                <tbody id="matches-table">
                    <tr>
                        <td colspan="4" class="text-center">Carregando...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Notificação</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBsP4YSbp3qeK-ViyVXhWp8Jf3KetimveU",
            authDomain: "snooker-scoreboard2.firebaseapp.com",
            projectId: "snooker-scoreboard2",
            storageBucket: "snooker-scoreboard2.firebasestorage.app",
            messagingSenderId: "695835616380",
            appId: "1:695835616380:web:17fc21b1d88f26c63055f9"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const matchesTable = document.getElementById('matches-table');
        const toast = new bootstrap.Toast(document.getElementById('toast'));
        const toastMessage = document.getElementById('toast-message');

        function loadMatches() {
            database.ref('seasons/2026/matches').once('value').then((snapshot) => {
                const matchesData = snapshot.val() || {};
                const matches = Object.entries(matchesData).map(([key, match]) => ({
                    id: key,
                    ...match
                }));

                if (matches.length === 0) {
                    matchesTable.innerHTML = '<tr><td colspan="4" class="text-center">Nenhuma partida encontrada</td></tr>';
                    return;
                }

                // Sort by date (newest first)
                matches.sort((a, b) => {
                    const dateA = new Date(a.date || a.timestamp);
                    const dateB = new Date(b.date || b.timestamp);
                    return dateB - dateA;
                });

                matchesTable.innerHTML = '';

                matches.forEach((match, index) => {
                    const row = document.createElement('tr');
                    const date = new Date(match.date || match.timestamp);
                    const dateStr = date.toLocaleDateString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const winners = Array.isArray(match.winners) ? match.winners.join(' e ') : match.winners || '';
                    const losers = Array.isArray(match.losers) ? match.losers.join(' e ') : match.losers || '';

                    row.innerHTML = `
                        <td>${matches.length - index}</td>
                        <td>${dateStr}</td>
                        <td><strong class="text-success">${winners}</strong></td>
                        <td><strong class="text-danger">${losers}</strong></td>
                    `;
                    matchesTable.appendChild(row);
                });
            }).catch(error => {
                matchesTable.innerHTML = '<tr><td colspan="4" class="text-center text-danger">Erro ao carregar partidas: ' + error.message + '</td></tr>';
            });
        }

        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            const toastEl = document.getElementById('toast');
            toastEl.classList.remove('bg-success', 'bg-danger', 'bg-primary');
            if (type === 'success') {
                toastEl.classList.add('bg-success');
            } else if (type === 'danger') {
                toastEl.classList.add('bg-danger');
            } else {
                toastEl.classList.add('bg-primary');
            }
            toast.show();
        }

        document.addEventListener('DOMContentLoaded', function() {
            const toggleButton = document.getElementById('darkModeToggle');
            const body = document.body;
            const html = document.documentElement;
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const currentMode = localStorage.getItem('darkMode') || (prefersDark ? 'enabled' : 'disabled');
            if (currentMode === 'enabled') {
                body.classList.add('dark-mode');
                html.classList.add('dark-mode');
            } else {
                body.classList.remove('dark-mode');
                html.classList.remove('dark-mode');
            }
            
            toggleButton.addEventListener('click', function() {
                body.classList.toggle('dark-mode');
                html.classList.toggle('dark-mode');
                
                const isDark = body.classList.contains('dark-mode');
                localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
                
                // Update the prevent-flash style when theme changes
                const preventFlashStyle = document.getElementById('prevent-flash');
                if (preventFlashStyle) {
                    if (isDark) {
                        preventFlashStyle.textContent = `
                            html, html.dark-mode, body, body.dark-mode { 
                                background-color: #121212 !important; 
                                color: #e0e0e0 !important; 
                            }
                            html.dark-mode h1, body.dark-mode h1 { color: #e0e0e0 !important; }
                        `;
                    } else {
                        preventFlashStyle.textContent = `
                            html, body { 
                                background-color: #f8f9fa !important; 
                                color: #212529 !important; 
                            }
                            h1 { color: #212529 !important; }
                        `;
                    }
                }
                
                document.dispatchEvent(new CustomEvent('colorSchemeChanged', {
                    detail: { isDark }
                }));
            });
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                const newMode = e.matches ? 'enabled' : 'disabled';
                localStorage.setItem('darkMode', newMode);
                
                const isDark = newMode === 'enabled';
                
                if (isDark) {
                    body.classList.add('dark-mode');
                    html.classList.add('dark-mode');
                } else {
                    body.classList.remove('dark-mode');
                    html.classList.remove('dark-mode');
                }
                
                // Update the prevent-flash style when theme changes
                const preventFlashStyle = document.getElementById('prevent-flash');
                if (preventFlashStyle) {
                    if (isDark) {
                        preventFlashStyle.textContent = `
                            html, html.dark-mode, body, body.dark-mode { 
                                background-color: #121212 !important; 
                                color: #e0e0e0 !important; 
                            }
                            html.dark-mode h1, body.dark-mode h1 { color: #e0e0e0 !important; }
                        `;
                    } else {
                        preventFlashStyle.textContent = `
                            html, body { 
                                background-color: #f8f9fa !important; 
                                color: #212529 !important; 
                            }
                            h1 { color: #212529 !important; }
                        `;
                    }
                }
            });
            
            loadMatches();
        });
    </script>
</body>
</html>

